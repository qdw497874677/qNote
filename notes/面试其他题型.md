## 介绍

### 自我介绍

面试官你好，我叫权大玮，今天24岁，目前是在西北大学读研三，我本科也是在西北大学，专业都是软件工程。**实验室方向是带宽调度，做的是研究数据中心网络中的传输请求的调度策略，主要是就基于高性能网络领域里面一些比较经典模型，去设计新的调度策略和路由策略，我这里去设计网络流的线性规划模型，去优化实时传输上的性能。**编程语言主要用的是java，数据库数据MySQL，有用过一些常用的开发框架比如Spring，Mybatis，SpringCloud的一些服务组件也有用过，也有去使用过常用的中间件比如Redis和Kafka。之前小米金融实习，岗位是后端开发。部门是用户增长，我当时主要接触项目就是小米金融APP的内容管理系统。另外一个就是去汇总数据提供客户端直接调用接口的相当于内容分发服务。分配的任务不是很难，大部分是写简单的业务。过程中主要了解到了开发的一些基本流程，包括用git去版本控制合代码，然后上线的一些流程。

我家是天津，老家是山西，因为我在西安也上学呆了7年了，也有点感情，希望以后能留在西安发展。

My name is Quan Dawei, 24 years old today。i come from tianjin。im a Graduate student at Northwest University in xian。My major is software enginiiering. I worked as an intern in Xiaomi for 3 months and I learned a lot.Thanks for xiaomi's help.i have been in xian for seven years.I hope to stay in Xi 'an in the future

中兴偏国企，华为偏私企。中兴和华为都是难兄难弟，都被美国制约制裁过



### HR面问题

#### 遇到技术困难咋办

1. 先查资料，百度、博客
2. 发现查效率不高的话，就去整理下，问同事，看看有没有遇到过，接触过，给一个建议

怎么看待华为

不管是美国制裁还是疫情，今年真的挺难得，希望中国的高科技企业能够挺下来，发展起来，尽早能摆脱尖端科技对外界的依赖，要转型让更多企业走到生产链条的上游，



#### 自己的优势

- **执行力好，有责任心**，安排的任务不拖着，做完才舒心。
- **细心**：**平时遇到问题会及时提出来**的。实习的时候编码遇到点感觉不合理或者不确定的地方就会去问mentor。比如
- **学习能力和表达能力还可以**：不管是平时学习中，还是之前实习中的，组内报告都能把自己认为比较清除的东西讲出来。实习中去追查问题的时候，也能比较清楚地把问题出在哪，当前我所处的位置，下一步要干什么整理清楚。比如组内我这里要做相对大的改动，我会把起因、影响和工作量都跟mentor汇报一下。有很多群，我也会经常去看别人的逻辑，去学习吧。跟同事关系处的还挺好的

#### 劣势

- 目前对**整个知识体系还不够广**，针对于实际中的一些架构思想还需要多积累，缺少一个宏观的理解，这个我也在去看相关的知识。
- 还是**应该多交流，不仅是遇到问题**，很多的东西都是可以交流的，布不知不觉就能够提高自己，这点我只能说我在朝着这方向努力。有些人可能对金融方面比较了解，有些对房地产比较了解，我就平时没事的时候就多了解了解问问，也增进感情奥。

#### 遇到的挫折

最近的话应该是疫情期间在家里准备找实习的时候，发现需要学的东西越来越多，因为可能当初对整个后端开发的轮廓不是很清晰，然后也低估了做这个岗位的门槛，以为毕竟实习嘛。但是实际上还是欠缺一些专业知识的，所以就一边面一边学，但是到后来的话就是越战越勇了。

#### 成就感最大的事

- 在学校帮导师做理论的复现，写C去做仿真代码，虽然C不太好，但是边看边写，还是比较快把任务完成了。在实验室第一次比较好得帮老师昨晚一个任务，还是比较有成就感的。
- 实习中一个比较重要的需求，**我们组这边负责的完成的不错**，我这边不说功劳肯定有苦劳，**基本收工后组长请我们吃饭，还是挺有成就感的**，虽说肯定是实习生水平，但是没有出啥差错，反应还是比较快的。
- 新来了一批学弟学妹，可能是扩招还是什么，就突然人很多。我作为两年的学长也跟他们讲了很多自己的经验，就还挺有成就感的。
- 在做新需求过程中，涉及到了一些老代码的逻辑出现的问题。其他业务方提出来了，我对与整个问题的处理还是比较迅速的。首先这些问题出现确实难免，毕竟也是测试环境的在开发过程中，带我的mentor和我现在负责这一部分的开发，都是之前没有接触过这个系统。我对于的问题的处理还是挺流畅的。慢慢地知道哪些使我们的问题哪些不是，因为涉及到一些别的部门接口的调用，需要去协调的时候也能比较好的去沟通，就很快把这些新需求做完，成就感还是挺大的。



#### 可以改进的地方

- **产品在某些功能的设计**上我觉得不是很方便，比如说CMS中有些按钮之类的他所在的模块不是很准确，对于使用系统的运营人员的学习成本比较高，因为逻辑上不是很容易想到。之前产品走了，这个就暂时先按原计划，等下个版本再去优化
- **RPC的一些接口定义**太多了，有一些接口的冗余比较大，看着就比较乱，可以在把哪些零散的参数定义成类去传递。
- 不同模块之间的耦合还是比较大，然后一些逻辑有些冗余了。
- 对于排序功能，我开始跟着做的时候，也在想为什么需要单独把模块的排序字段拆出来做一个新的表，然后表中模块的数据和模块信息表中的数据基本是一一对应的。后来问了当初需求就是说对于一个模块，如果想让他可以显示且可以排序，就通过一个按钮去设置，然后写的逻辑就是去把对应的模块信息的部分字段加上排序相关的字段放在一个新表中。读取数据需要现根据排序表中的模块数据来决定，

#### 亮点

优惠券项目

- 关于判断模板过期的策略，用到一些从别的地方看到的一些思路，应该也是比较常见的方式了
  - 定时遍历+延时处理：定时从数据库中取数据区判断是否过期，如果过期就修改状态。同时在查询时去过滤过期的模板，留给定时任务去处理。
- 生成优惠券码：
  - 通过单实例提前生成好，简化唯一性的要求，然后缓存到Redis中。
  - 生成过程通过异步的方式，生成完毕后修改模板的可用字段。
  - 
- 在做新需求过程中，涉及到了一些老代码的逻辑出现的问题。其他业务方提出来了，我对与整个

#### 困难

- 实习刚开始的阶段，我要做的工作很大部分是涉及到很久没有动过的代码，这部分是会有遗留问题。然后对于需求中哪些是可以复用的，哪些是需要找部分新接入的，这部分对于整体业务之间的关系不是很熟。当时这块也是走了点弯路，我mentor也是才来不久，跟我说了有哪些人后，我就尽我可能吧，把问题表达请求，然后看相关接口的wiki文档。把问题也写在我们部门的wiki下面，让leader知道我现在的情况。



#### 实习收获

非常有意义，这是我第一次不是那种学校组织的这种实习经历。真正地把自己学的东西用在实际中了，很有成就感。

1. 有了解到一些自己没用过的**新技术**，写代码更熟练了，也是有比较多的代码量吧。提升了一些**查找问题解决问题的能力**，测试环境和正式环境的问题都能比较快的定位到（通过抓包和日志）。
2. **了解了项目开发流程**，包括提交合代码，跟人联调，上线流程，
3. **体验**了互联网行业的相对**快节奏工作生活状态**，开始是会感觉比较忙，但是忙着忙着就发现挺有成就，毕竟是学习阶段，忙是好事。
4. 适用去**跟同事交流**，请教一些问题。有什么事啊不要憋在自己这，把问题整理下多请教，包括组内和其他部门的。我们那时候那个项目里有联系的部门还比较多，总的叫一个融合项目，不同部门一起去联调去测问题，我涉及的那部分有分发服务所以，部分属于那种偏联系的，接入的部门联系比较多。尽量快速确定关键点，然后问的时候多找几个见证的。
5. **日常记录和规划**这方面也学到很多。实习的时候相对学校更忙，对于工作的规划除了每天的晨会和每周的周报，平时对于更多的事，都习惯去及时做好笔记。学校也会有但是强度没这么大。

#### 为什么不选择转正

- 学校有一些事情，再加上实习那段确实会比较忙，我想着离职一段时间，从这个业务中出来去空出一点时间准备一些别的东西，比如毕业设计的实验，然后是实习中接触到但不太懂的那部分，比如微服务那块之后接着去看了看。留用转正的话我就没有考虑，我在实习已经三个月了，
- 实习的时候确实学到很多东西，但是对于当前的状态不是很，一些比较杂的耗时的事情比较多，所以想先出来再去考虑下我需要什么，然后多花点时间来提升一下其他的知识。想出来多花点时间在一些相关技术的

#### 未来规划

曾经有想过是银行国企还是互联网。如果是在国企感觉之后的日子一眼望穿，也不会有太大变化了。互联网工作虽然很多人说累，但是才毕业就想着轻松，感觉没什么意义。何况我感觉还挺有成就感的，毕竟钱也会多一些。如果多余的时间我不能好好利用，就不如在技术公司多打磨打磨，提升下竞争力。但是一是技术好氛围好，二是对人的提升很大，我现在不是很想就。

因为还没有毕业正式工作嘛，所以就我目前的前期的想法就是去**学习积累技术**，从**代码细节**到一个对**业务的整体的理解**，然后还有**分析问题**的能力，都需要去积累的。多提升一些竞争力吧。然后就是技术之外的，包括一些**协调、沟通的能力**还是要在工作中去提高的。反正总体开始要做到**业务能力上游刃有余**把，就挺有成就感的，也给更远的发展打基础吧。



#### 如何学习

- 去问有过经验的人。比如从论坛、博客、同学、同事。
- 主动看资料。有了大概的方向后，去看相关的书，或者是一些视频资料。
- 动手去做demo。遇到问题接着先去问然后看资料。
- 一定要有计划。我下周要做的要看的基本上都记在手机日程里，因为有的时候事多了，难免会忘了。
- 多记笔记。记录下来不仅是多增加印象，之后回来看的时候能发现之前的理解和现在理解的不同。
- 复盘很重要。一段工作做完之后，要回过头来看，找到自己最应该补充的点，记在日程上。



#### 近期看的书

- 设计模式
- Java并发编程



#### 工作城市

比较偏向于北方，最好是北京、杭州上海也考虑。

#### 兴趣爱好

我还是相对宅一些的人，更多是喜欢一些听歌，电影什么的

- 比较喜欢电子产品，相关的产品评测开箱什么的比较感兴趣，比较关注相关的新闻。
- 对主机游戏和桌游都比较有好感。桌游虽然玩的不多，但是很喜欢不多的几次桌游经历，自己也买了一些入门的作品，和同学在学校偶尔会开个局。桌游有：风声，盗梦都市，犯罪现场，宝石商人（资源管理）。
- 喜欢看电影美剧。还记得的比较喜欢的美剧：生活大爆炸，废柴联盟，守望者，鬼入侵，传教士（坚持，友谊，内疚，反套路，黑色幽默，封测，节奏吸引人）

### 实习项目

项目介绍：我这边是在用户增长部门，我是后端开发，我实习涉及的一个项目提供**小米金融客户端直接调用的接口**。这部分这段期间有两个大需求，

首先是页面改版，我主要负责开发两个新接口，给客户端提供页面数据。然后就是融合其他客户端，要把代码改造，让很多个新发版的客户端调用。然后就是开发一些新功能和bug修复 

- 一是多个业务的独立app都要融合到我们的接口里，我们要去提供每个业务新客户端的调用。尽可能复用代码（页面每种类型的内容的处理），然后单独的需求单独做。这块对代码改动还挺多的，主要是页面中每个部分数据的处理的代码给整合起来，用责任链连起来
- 二是首页和个人中心改版。我们这边提供数据也要改动，要有新的数据来源，接入新的业务接口。
- 对应的CMS这边也是两个任务，
- 一是融合其他APP的内容管理，
- 二是加了一些新的需求，比如页面模块排序，编辑内容的复制。研发这边业务主要是，活动后端，给金融app提供数据的后端，提供给运营去编辑app内容的一个平台CMS。

#### 背景

我所在的是用户增长部门的开发组。这边主要是做用户增长相关的技术支持的。我实习涉及到的就是app内容管理系统，系统可以修改app页面中用到的一些资源内容，还有提供app内容的一个项目，这两个项目就可以提供客户端大部分数据内容了。当时其他部门的新版app都融合我们这个之前只支持小米金融一个app的系统。然后新版app的页面内容也大改，我这里主要做的就是让系统支持多个app的调用做不同处理，然后就是开发新版页面的接口。然后同时过程中还有一些小需求要加，去改一些之前的bug。

**一是品牌变更升级，去适配新的客户端，有些页面上改动比较大。然后就是用户增长这个系统上要去新支持几个新客户端。就需要重新改一些接口去做支持，然后同时对不同组件的处理逻辑划分更清晰。**一是在源系统开发新接口，提供给新客户端调用。然后把之前的每个组件的代码重新写成单个的处理器。编写一个处理器注册类去初始化处理器，当查询到客户端需要的组件模板时，然后根据不同组件类型选择不同处理器处理然后放到结果集中。

客户端请求页面的调用流程：

- 调用接口，主要的参数有，mid、appid、pageid等
- 分发服务去数据库查询对应appid和pageid的所有组件内容。这是组件内容的修改和创建都是在CMS中去完成的。
- 拿到组件类型。有些组件内容包含运营配置的，有些组件内容完全需要去透传获得，有些需要多个接口数据。针对组件原始数据集合，通过聚合类，不同类型的任务分配给不同处理器做处理，最终汇总数据。返回给客户端。

#### 简要说自己做的两件事

- 新版个人中心接口
  - 对于客户端每个组件的的构成有一部分是服务器端控制的，我的其中一段时间就是做这个新接口
  - 其中个人中心页面的有些组件的数据是客户端再单独去调另外的接口。比如个人账户信息模块中的每个入口信息，包括银行卡数量，用户积分，优惠券数量和具体优惠券数据等。
    - 这些接口和之前相比都有变化，因为很多业务融合到一起了，比如**银行卡的汇总**，**优惠券的汇总**，都要加上这次融合新加入的业务（支付）。还有新加入的**米币入口**，要去提供新的接口。
- 融合项目
  - 很多个其他业务的客户端都要接入到我们之前这个只支持小米金融一个app的系统中。现在用appid来区分。所以对于项目代码中所有涉及到有影响的地方**都要去做支持**。然后不同的APP的需求还不同，对于页面中一些模块的数据有不同要求，这些我们在接口里去做单独处理。为了让逻辑更简明，所以把负责页面中每个模块的代码都拎出来，组成处理链，每个模块处理逻辑里面去根据参数不同去做处理。之前的业务代码比较直接吧，有一些类里很臃肿，所以也需要我们去对一部分代码做一个简单的重构，也是为了方便支持之后更复杂的需求吧。
    - 具体设计：把处理不同类型的逻辑封装成处理器，再创建一个聚合功能的类，这个类负责去注册处理器，然后根据数据库查到的客户端需要的组件类型集合，去选择处理器来处理每种组件内容，最终汇总到一起返回给客户端。
    - **具体流程**：客户端请求数据，先从对应app页面的原始数据从CMS系统处理的数据库中取出来，放到处理类中，让每一个hander去加工组合数据，最终返回给客户端。
  - **数据库表结构也有改动**，除了主键，多app的数据还是存放在之前的表中，某些字段的唯一性有变化了，对于dao层sql就也要去改。因为新的需求，多个页面可以支持相同类型的组件，所以模块信息表的模块类型也不是唯一的了，需要结合pageId去保证查询唯一。
  - 因为**存在不同页面相同模块类型**的情况，模块类型单个字段变成不唯一的，导致**之前的埋点信息也要改动**，数据分析那边无法区分一些页面上的模块了，所以这边也要做协调，改成新的打点信息，代码里埋点逻辑还是比较零散，就需要把逻辑提出来。
  - 同时**新增了页面中的一些模块**。写对应的业务代码去组装数据。有一些其他业务方提供的接口的返回结果不满足新需求了，就要协商新的接口的需求。新接入的接口需要去对接密钥，用iauth去做验证。
  - thrift定义的枚举和接口参数和Bean的属性，都要做相应的改动。数据库对应一些写死的数据要去根据不同的需求同步到其他app中。
  - 帮人改bug，同事之前写的有一些问题，测试找出来，然后我就帮他们改
- 其他新需求或者bug处理
  - APP后端
    - 优惠券汇总相关接口有改动
      - 增加新的业务方的优惠券接口
      - 保险的优惠券类型改动，提供所有可用优惠券接口和所有即将过期优惠券接口就需要改动
    - 红点信息缓存相关
      - 处理如果更新和消除优惠券即将过期气泡。增加优惠券即将过期红点信息的缓存
      - 处理如何更新和消除底部气泡。这个状态不能存在客户端，消除气泡肯定是要客户端主动来调用消除的接口。底tab气泡是否展示信息的缓存
    - 埋点数据问题
      - 当时数分那边找我，页面上的一些埋点数据有重复的。然后我们就聊这些问题怎么出现的。就是因为之前代码考虑不周全，数据库里有些字段冗余了别的字段，就比如说模块类型的字段数据中有页面英文。之前没问题是因为一个模块实际上确实是只出现在一个页面中。现在新需求中同样的模块会出现在不同的页面，比如首页有个福利banner，个人中心还有个福利banner，所以要找出所有从数据库取数据做埋点的代码，统一写个工具类去做一个拼接
  - CMS
    - 模块在页面中的位置可配置
      - 新增可排序模块的表，放一些模块信息，排序位置，是否展示等字段
      - 在APP后端代码里加入处理排序数据的逻辑，对于可排序模块去根据配置的位置做调整
    - 新增用户设备匹配配置
      - 增加了是否为nfc手机的判断逻辑，当然具体客户端传来的参数来判断的，这里主要是写在这个
    - 编辑内容根据权限可以复制到对应其他模块的功能
      - 根据这个moduleinfo中的appid和pageid跟权限去做比对，筛选所有类型一样的模块，然后和前端去做联调
      - 对前端要提供两个接口
        - 提供所有可复制到的目标
        - 对用户所选的目标，做对应数据修改和插入

#### 参与的项目细节

- 金融app的后端，就是负责app提供页面数据，包括app中的一些运营资源位数据，用户相关信息，这些一般都是调别的业务部门提供的接口，因为这些接口涉及的部门还挺多，要跟他们去沟通。负责提供给数据分析那边的埋点信息。web项目和service层项目用thrift去调用
- CMS，可以通过CMS去增删改APP中的一些模块内容，可以设置模块的一些属性，和一些展示条件、展示顺序。api项目作为web项目提供给前端接口，service层项目操作数据库，通过thrift提供远程调用。调用一个是app的api后端和service后端；一个是CMS系统的api后端和service后端。

- 运营通过CMS系统可以控制APP各个tab页面包括弹窗、开屏、底tab的大部分可配置内容，一般是组件的相对顺序和资源组件的内容。
  - 为一个模块**新增内容**，为内容设置过滤条件和模块自身特殊的配置规则（跳转连接，图片等等）。
  - 更改模块之间的是否显示和**相对顺序**
  - 复制一个内容到其他允许**复制**的模块中
    - 获取内容id对应的内容的模块类型，根据类型从库中查出所有相同类型的模块信息（模块信息可通过模块类型和页面id和appId来确定唯一性），去查用户的角色权限，比对appId和页面Id的权限是否符合，然后把可操作的模块过滤出来，返回给前端
    - 前端把对应用户的选择发给后端，后端把目标内容状态置为准备状态，进行插入对应的app和页面数据里。
  - 将修改的内容**发布上线**：
    - 如果内容没有设置用户集且第一次发布上线，
    - 如果有配置用户集，需要发送到消息队列处理
    - 对于内容生效时间比当前时间晚的内容的处理，
- C端服务端通过CMS配置的模板对整个APP需要下发的数据进行汇总处理。C端有一个组件处理模块，根据运营所选择配置的组件信息进行不同的处理，将所有组件汇总放到对应页面的items里。
  - 可以对CMS中每一个配置好的组件内容进行处理：匹配用户集，匹配设备，匹配用户个性配置、匹配地区
    - 用户特殊配置的匹配：看看是否有内容需要针对当前请求的用户做特殊处理。
      - 1.**检查是否需要用户特殊配置**。遍历所有内容，先判断组件是否需要用户集匹配（用户集是在配置的时候上传的，根据模块类型和内容id区分缓存在Redis中，在Redis中是以bitmap来存储的）。然后在缓存中查找是否存在用户id或者设备id。如果需要就取出用户集配置。
      - 2.**取用户特殊配置**。根据用户id和设备id从缓存中取，缓存没有从hbase取并加入缓存。
      - 3.根据特殊配置匹配内容是否要加入结果中。
    - 用户状态的匹配：每个content内容可以设置：登录可见、理财新用户可见、贷款新用户可见
    - 设备匹配：
  - 根据需要对用户行为进行收集。
  - 将异步调用的操作位置优化

#### 成就感



#### 用到Redis的地方

- 底部tab的气泡：每一次配置气泡内容都会生成一个新的气泡版本。要求每个气泡在未登录情况下每台机器只显示一次，登录情况下每个用户只显示一次。当获取底tab的信息时，会根据用户id，把在Redis缓存的气泡的版本取出来，和当前拿到的版本做比较，如果不相等就表示还有点击（清除），相等就表示不需要气泡数据了；在调用清除气泡的接口后，把redis中对应的气泡版本更新为当前的气泡版本。这样下次就不会加气跑了
- 用户优惠券过期状态：在优惠券整合接口中，如果有快过期优惠券，就把最远的过期时间放到Redis中（相当于优惠券过期状态版本）。把用户优惠券红点状态缓存到Redis（uid，true）。当需要清除红点就把红点状态改为true，当优惠券过期时间有更远的时间时，就需要把红点状态设为true。
- 话题pk组件
  - 用户投票记录存放在db中
  - Redis中存储话题投票数量。key为话题组件前缀+话题id+左/右
  - 提供刷新缓存的服务：把数据库的话题pk信息放入redis



#### 用到mq的地方

- 上线下线操作中如果这个组件配置带用户集，就先改数据库为上线中或者下线中模式，然后放到消息队列中延时处理来上下线



#### 上线下线流程

状态为：准备-上线中-上线-下线中-下线

- 创建一个内容模板后保存后，就是准备状态
- 对准备状态的内容模板，调用发布接口之后，就会进入上线的逻辑
  - 如果有耗时工作（设置了用户集），就通过mq异步处理，状态先改为上线中
  - 如果没有耗时工作，直接修改状态为上线。
- 下线分为：自动下线和主动下线
  - 自动下线：针对过期内容的处理。定时检查+延迟处理（过滤）。
    - 会有定时任务去定期检查在线状态的内容，发现过期后检查如果有耗时工作就通过mq异步处理，设置为下线中状态。否则进行下线操作。
    - 在查询时，过滤暂时还是上线状态的却过期的内容。
  - 主动下线：直接调用下线接口。直接根据内容id，检查状态，执行下线操作。
- 修改内容：对已有内容修改，对应草稿表中的内容状态改为准备。
- 状态操作：就是根据目标内容，改变内容状态，包括草稿到线上表的操作，根据不同的目标状态值来执行不同操作。当从上线中切换到上线、下线中切换到下线，就会同步到线上表中。

#### 延时操作

编辑组件内容时可以**设置生效时间和过期时间**

- 在分发服务中，获取客户但组件数据时，从DB中拿上线状态的组件内容。过滤其中实际上过期的（过期时间<=当前时间）
- 定时任务：会从DB中取出上线状态的已经**过期**的组件内容，去做下线处理（修改状态，如果有数据集就去放到MQ异步处理）
- 定时上线：通过定时任务，从草稿表中取出所有到达指定时间的上线状态的内容，去做上线处理

#### 困难

- 理解业务
  - 搞清楚各个功能或者数据的调用关系，出现问题去查日志，去抓包看url找问题源头（有些问题不是报错是数据显示跟预期不符，有些数据是在我们项目里做一个中转）
- 开发流程
  - 这也算是第一次去熟悉整个开发流程。
    - 需求阶段：还要第一次大需求我没在，后来就是看文档跟pm沟通。第二次大需求，就是开会，就直接会上把这个实现难不难，大概思路，大概时间预期和同事就直接沟通一下。
    - 开发阶段：git拉、推、合，代码段junit自测，上测试环境自测
      - junit：之前有写好的Test基类，里面初始化了Spring容器，把项目主要的一些前置工作都做了，比如获取iauth认证啥的
    - 测试阶段：各种jira，有大有小，日常看测试报告，我这边主要就改，也帮导师去改。问题各种各样吧，不一定是啥大的技术问题，基本上都繁琐的小改动，过程中发现问题，需求和代码有时候都需要改。
    - 上线：合代码，review代码，跟导师讲代码，提SQL审批，提上线审批，上线盯着日志。
  - 新增功能
- 第一次上线
  - C端项目中，存在
- 依赖问题
  - 简写：修改提供rpc接口的一个服务和对应的thrift，在增加新的业务类型的优惠券汇总，测试环境
  - 写一个汇总优惠券的接口，这个接口在提供服务的一个服务里。后端的api服务rpc调用这个接口，然后http接口暴露出去。有一个需求是加一个支付业务那边的优惠券。这个枚举是加在thrift里的。测试环境都好着，因为引的依赖都是测试包。线上的api服务的依赖没有更新。
- 依赖冲突
- 历史问题

#### 亮点

- 

#### 难点

- 然后就是熟悉业务的过程，我刚来就已经是很需要人手，开始在一知半解的情况下，对新需求的的推进不利
- 刚上线的时候，感觉相对繁琐一些，多个相互调用的项目上线，还涉及到依赖包的改动。
- 我们的项目设计连接了很多其他部门的接口，新版本会发现一些历史问题，之前的负责这系统的老人也不在。需要和不同部门的协调，刚开始对于除了问题是不是全是我们的问题，不是去找谁，要怎么去沟通现在问题，要怎么去协调要搞清楚。

#### 有什么可以改进的地方

- 做了一些和产品没有交流好的功能
- 之前的排序表
- 对于排序功能，我开始跟着做的时候，也在想为什么需要单独把模块的排序字段拆出来做一个新的表，然后表中模块的数据和模块信息表中的数据基本是一一对应的。后来问了当初需求就是说对于一个模块，如果想让他可以显示且可以排序，就通过一个按钮去设置，然后写的逻辑就是去把对应的模块信息的部分字段加上排序相关的字段放在一个新表中。读取数据需要现根据排序表中的模块数据来决定，

#### 实习学到了什么

1. **写业务更熟练**，太复杂的也没交给我。更熟练的去用一些Java8的新特性，比如函数式编程与Map结合减少ifelse。提升了一些查找问题解决问题的能力。之前是没有什么找线上问题的经验。代码量还是有的，熟能生巧
2. **了解了项目开发流程**，包括提交合代码，联调，上线流程，
3. 对于企业开发的大概流程有了了解，体验了一下互联网行业的快节奏工作生活
4. **学会处理人际关系**，有点这个工作的人情世故的经验，然后做事要界限明确。我们部分属于那种偏联系的，接入的部门联系比较多。尽量快速确定关键点，然后问的时候多找几个见证的。
5. 对工作有个一个**更详细的规划**，更好把控自己的工作量，其实是跟学习也是类似的。

 

#### Thrift

##### 使用

典型的CS结构。通过IDL（接口描述语言）来关联客户端和服务端。

thrift根据IDL生成客户端和服务端的代码。

TProtocol用来对数据进行序列化与反序列化。

TTransport提供数据传输功能。定义了如下几种常用数据传输方式：

- TSocket：阻塞式socket
- TFramedTransport：以frame为单位进行传输，分阻塞式服务中使用
- TfileTransport：以文件形式进行传输





thrift用socket进行数据传输，数据根据特定的格式发送，接收方进行解析。



#### Hystrix

熔断

给对其他业务提供的http接口的调用配置一些信息，比如超时时间，故障的处理（比如10s内50%出错就熔断5秒，之后放出一部分请求试探）

用command对象的形式去设置一个http调用的熔断，参数定义在一个枚举中。



#### 怎么做沟通

#### 为什么选择这个专业

#### Java有什么地方不好

#### 产出



### 实验室工作

#### 介绍方向









### 博客项目

#### 设计数据库

- 博文表：id，作者id，作者名，标题，摘要，内容，发布标记，访问量，时间，分类id。
- 分类表：id，分类名称，时间
- 标签表：id，标签名称，时间
- 博文-标签表：id，博文id，标签id
- 评论表：id，博文id，用户id，目标评论id

博文表和分类表是多对一的。

博文表和标签表是一对多的。

评论可以划分为：留言和讨论，留言是针对博文的评论，讨论是针对留言的评论

如果是留言，那么评论的目标评论id就为-1。如果是讨论，评论的目标评论id就是可以展开讨论那条留言。

#### 查询

- 查博文带分类带标签：博文和分类是一对多，和标签是多对多。博文和分类用一个sql（博文联表分类表），博文和标签用另一个sql（根据id到博文-标签表中查联表标签表）
- 查对应博文最多的分类：分类和博文表联表，根据分类id分组，count降序
- 查对应博文最多的标签：用子查询查映射表，根据标签id分组，根据count降序。根据这些id去查标签内容
- 查博文的所有留言：根据博文id和目标评论id为-1，查评论数据
- 查留言的所有讨论：根据评论id，查评论数据

#### 排行

在Redis中用zset来存储，score为访问量，value为博文id。通过定时任务将数据库中的访问量表的大部分访问量和博文id更新到redis中。这样可以根据redis快速获取访问量前多少个。

访问量先更新redis中的数据，然后定时任务从redis中同步到mysql中。启动时先从数据库同步到reidis中。同步区间比过期时间短。获取访问量从redis中访问。

#### 延时队列

我做了一个定时把保存的博文改成发布的状态。没想去引入别的中间件了，就想着用Redis实现一个简单的定时计划的功能。

实现思路：

- 用String类型做消息池，用这个key作为id，value为自己定义的消息体。
- 用Zset做优先队列，score存储当前时间+时延，来维持优先级，value为消息id
- 去轮询zset，拿出score比当前时间大的消息id。
- 根据消息id去取对应的消息。
- 反序列化成消息类型，然后放到责任链中去处理。
- 消费成功后，删除对应的优先队列数据和消息数据
- 消费失败，重新生成消息

代码：

- 定义消息，包括id、类型、延时时间、数据
- 定义不同消息的hander，针对不同消息做处理的类
- 创建消息消费者，把hander组成责任链，来处理每个消息。处理失败就把优先队列的数据再放到队列中，成功就把消息和队列信息删掉
- 创建消息生产者，负责创建对应的消息，然后到消息池和优先队列中



#### 缓存一致性



MySQL更新同步到Redis

- 我这里用了一个比较简单的办法当对mysql数据做修改时，就对redis中对应的数据删除
- 可以用binlog，用额外的工程做binlog分析和同步

查询博文先到Redis中查找，如果没有会从数据库查更新到缓存中

#### Spring定时任务

在Application启动类上添加@EnableScheduling注解开启定时

在组件中用@Scheduled启动定时任务

接收一个cron表达式，是一个字符串，以5或者6个空格隔开，分开共6或7个域，每个域代表一个含义

[秒] [分] [小时] [日] [月] [周] [年]



#### 登录功能

我引入了shiro权限框架。

- 实现shiro的AuthenticationToken接口，创建jwt类
- 编写认证过滤器：主要是处理每个请求的jwt，检查是否过期，然后执行shiro的登录验证逻辑。同时也处理登录失败的响应方式。
  - 继承shiro的AuthenticatingFilter过滤器，重写一些方法：
    - 创建token
    - 请求拦截，检查是否可以通过
      - 如果没有jwt，就直接通过，说明需要进入登录界面来验证用户信息，生成jwt
      - 如果有jwt，验证是否过期，如果没有过期执行登录的逻辑，登录成功就通过。
    - 登录失败处理：把错误的信息包装起来返回给前端
- 编写realm类：定义登录认证和权限认证的逻辑。
  - 登录认证：把数据主题从自己定义的jwt中拿出来（userid）。从数据库中找到对应的用户数据，放入认证信息中返回。
- 登录controller
  - 判断用户名和密码是否正确。
  - 如果正确，用shiro生成jwt，放进http响应报文的Authorization上。
  - 浏览器会把jwt放在Authorization字段上，再次发送请求。





### 优惠券项目

- 模板模块：提供创建优惠券模板、查询模板、清理过期模板等功能
  - 创建优惠券模板：创建模板信息，异步生成优惠券码（产品线2+类型2+日期6+随机数8）存入Redis。异步通过SpringBoot中提供的异步任务，使用自定义的线程池。
  - 查询模板：分发模块调用的。包括查全部可用和根据id查询。把模板的实体类转换为SDK类提供其他服务使用（去掉一些字段信息）。
  - 清理过期模板：
    - 定时检查：通过定时任务，每个小时从数据库查询未过期模板，然后检查是否过期，更改状态
    - 惰性检查：在查询时判断是否过期，过期的从结果中过滤掉，让定时检查去处理
- 分发模块：提供查询可用优惠券、领取优惠券、优惠券结算。还有操作Redis中优惠券缓存的服务，Kafak异步任务的服务
  - 查询可用优惠券：调用模板服务，根据模板id查询所有可用模块。去查询用户所拥有的可用优惠券，检查所有模板中的规则关于可以持有几张，去比较如果不符合就过滤掉。
  - 领取优惠券：根据模板id查询到模板信息，比对领取数量规则，从Redis中获取优惠券码，生成优惠券对象存入DB，把可用优惠券券更新到缓存中。
    - 查用户优惠券考虑缓存穿透
  - 结算优惠券：检查优惠券是否过期，然后调用结算模块去结算
- 结算模块：提供优惠券结算
  - 抽象出处理器接口：返回处理类型、对结算信息处理返回
  - 创建一个抽象处理器，先定义好共用的一些方法，比如计算商品总价、返回最小金额、保留小数
  - 实现各种处理器
  - 创建处理类管理类：加载所有处理类，所有的处理逻辑从这里作为入口，选择对应的处理类处理



### 实验室项目

SDN背景下的针对时延不敏感的数据传输调度策略

给定**网络拓扑**，**链路带宽资源**，**传输请求**约束，去**分配不同时隙下每个传输请求的路径和带宽**。之前就先**对所有请求根据不同权重去排序**，然后使用基于地杰斯特拉算法，结合别的参数比如带宽、跳数等，依次去算最终分配的路径和带宽，然后更新网络资源，不断重复计算。是这样的一个贪心的算法。

我后来用线性规划的方式，把上面分配带宽和路径的问题建模。每个节点之间设定一定的默认路径。对于一个请求可以设定多路传输的情况下，每个路径设定对应的流量值作为变量x。然后加上网络流问题的一些自然约束，比如链路中流量之和不能大于最大流量，每个流量值x大于0，一个请求的流量之和等于请求的传输需求。整体再加上时隙这个维度。

对于上面约束出来的方程还有很多问题，比如如果没有解，也不会有次优解、参数过多计算复杂。通过一些方法去解决，比如引入虚拟路径保证有解、部分情况使用贪心减小计算规模。





### 反问

- 面试流程
- 什么部门，主要的业务是什么
- 面试中不会的问题
- 技术栈
- 平时啥工作时间



## 单选题

> 关系代数运算中，五中基本运算为

并、差、交、选择、投影

> 以下关于设计模式的说法中正确的是：D
>
> A. 相对于工厂模式，抽象工厂不需要新的类只需要新的实现
>
> B. 适配器模式和桥接模式都用于兼容已设计的不兼容类的同时工作
>
> C. 观察者模式可用于对不一致状态的目标发送消息
>
> **D. 迭代器模式的实现中通常需要实现空迭代器**





## 概率题

### 1

> 猿辅导公司某研发小组一共有 12 名同学，其中 9 人能做后端开发，6 人能做前端开发。现在要抽调 4 名同学成立项目小组，负责公司的一项“机密”项目。其中 2 名同学做后端开发，2 名同学做前端开发。有多少种选派方法？

(1)只会后端:6个人；

(2)只会前端:3个人；

(3)既会后端又会前端:3个人;

一.从(1)和(2)分别挑两个人，C(2,6)*C(2,3)=15*3=45;

二.从(3)挑1个放前端，有C(1,3)*C(1,3)*C(2,6) = 135;挑一个放后端,有C(1,3)*C(1,6)*C(2,3)=54;

三.从(3)挑2个放前端,有C(2,3)*C(2,6)=45;挑2个放后端,有C(2,3)*C(2,3)=9;1前1后，有C(2,3)*C(1,2)*C(1,3)*C(1,6)=108;

四.从(3)挑2前端,1后端,C(2,3)*C(1,6)=18;1前端,2后端,有C(2,3)*C(1,3)=9;

全部相加:45+135+54+45+9+108+18+9=423



### 2

> 猿辅导公司某部门月会上，有 5 名同学在依次领取入职周年的礼物，一束鲜花。HR 共准备有 5 种不同颜色的鲜花供他们挑选。则有且仅有两名同学挑选了相同颜色的鲜花的概率是多少？

共有5 * 5 * 5 * 5 * 5=3125种情况，每个人可能选的花色有5种

再算有且只有两个人选同一种颜色的情况， 

1.选出两个人C52=10; 

2.选同一种颜色有5种情况; 

3.其他3个人从剩下4种颜色选：4 * 3 * 2=24. 

共有10 * 5 * 24=1200 概率为1200/3125=48/125.

## 智力题

### 扔硬币

> A和B猜每次扔的硬币的正反，猜错的话里一个人继续扔，从A开始，A先猜对的概率为？

2/3

### 两根香

> 两根不均匀的香，每根能燃烧60分钟，现在要精准算出15分钟

想把第一根香的两头，和第二根香的一头点燃。当第一根香烧完时过去了30分钟，第二根香剩下的部分从一边烧能烧30分钟。此时把第二根香的另一边点燃烧完就过去了15分钟

### 两个桶

> A桶容量为5，B桶容量为3，要求计量出4的水

A桶倒满，用A通的水把B倒满，A还剩2的水，把B的水倒掉，把A的2的水倒到B中，B中有2的水差1就满。把A灌满，用A的水把B倒满，A就只剩4的水。

### 赛马

> 25匹马，5个跑道，最少需要比赛多少场就能决出前三名

1. 5匹为一组。每组前三名都有可能是前三，剩下的排除，**剩15匹马。赛5场。**
2. 每个小组的第一名放在一起比赛。第一名肯定是第一，排除，**剩14匹马。赛1场。**
3. 最终第一名已经定了，现在需要找出最终第二名和第三名。**2比赛中的二、三名和一所在组的二三名，二所在组的二名，只有这5匹可能在前三中。**
   1. 如果2比赛中第二名比最终第二、三名都慢，那最终第一名所在组的第二、三名是可能是前三，待比赛+2。
   2. 如果2比赛中第二名是最终第二名，第三名比最终第三名慢，那么第二名坐在组的第二名可能是最终第三名，待比赛+2。
   3. 如果2比赛中第三名也可能是最终前三，待比赛+1。
4. 5匹马正好可以比一次，找出第二名和第三名。**赛1场。**

**最少**赛7场就可以找出前三。



### 海盗

> 5个海盗分100个金币，如果一个人提出的分配方案得到半数以上（含半数）的统一就执行，否则处死第一个人，再由第二个人提方案。第一个人怎么提方案可以获得最大利益，又不会被处死。每个人都会理性的追求最大利益。

从后向前推

- 假如最后只剩下4和5，此时是4提方案，4肯定会提100，0。这样5肯定拿不到钱，所以他也需要3活着。方案为：100，0。
- 3号提方案时，知道5号只能拿0，所以给5号1来拉拢，5必须接受因为3死了自己只能拿到0。方案为：99，0，1。
- 2号知道3号给4号0，所以给4号1来拉拢。方案为：99，0，1，0。
- 1号知道2号要分给3和50，所以要给3和5分别1来拉拢。方案为：98，0，1，0，1。



### 12小球称重

> 12个小球，其中一个质量不均匀，现有一个无砝码的天平，请问怎么在**3次**称重内确定有问题的小球？

说先把小球分为三组，每份四个。（1、2、3、4）（5、6、7、8）（9、10、11、12）。拿出前两组放在天平两侧。用C表示正常球。

- 天平平衡：说明这八个小球是正常的。目标球在第三组中（9、10、11、12）。接下来把第三组中的三个正常球作为一组放在左边，另一边放三个正常球。（9、10、11）（C、C、C）
  - 天平平衡：说明12是目标小球
  - 天平一高一低：把左边中两个比较大小。（9）（10）
    - 天平平衡：说明11是目标球。
    - 天平一高一低：在上一步（9、10、11）如果低，这次低的球为目标；如果上一步（9、10、11）高，则这次高的球为目标。
- 天平一高一低：目标在这个8个里面，另外4个是正常的。接下来把天平两边放（1、6、7、8）（5、C、C、C），即左边为一个一组的三个二组的，右边为1个二组的三个正常的。
  - 天平平衡：说明目标在（2，3，4）中。接下来天平两边放（2）（3）
    - 天平平衡：4为目标球。
    - 天平一高一低：如果之前（1，2，3，4）所在的边如果高，那么这次高的就是目标球；上次如果低，这次低的为目标球。
  - 天平一高一低：如果上一次左边高，这次也左边高，说明1比较轻；如果上一次左边高，这次右边高，说明目标球在移到左边的三个中（6，7，8）。接下来天平两边各放一个（6）（7）
    - 天平平衡：8为目标球。
    - 一高一低：如果之前（6，7，8）是低的，那这次低的为目标；如果之前（6，7，8）是高的，那这次高的为目标。



### 耗子药

> 1000瓶药，有一些可能有毒，用老鼠来喝药，喝到有毒的一周就死。一周内至少需要多少只老鼠才能检测到哪些有毒

二进制，死=1，不死=0，老鼠=bit，答案 lg1000 = 10



### 变质药

> 有10瓶药，每瓶有10粒药，其中有一瓶是变质的。好药每颗重1克，变质的药每颗比好药重0.1克。问怎样用天秤称一次找出变质的那瓶药。

把药编号1-10号，分别取出1-10粒。用天平量出总共重量为x。

((1+2+...+10)-x)/0.1就是变质药的编号。







## 场景题

### 红包算法

#### 方法一

二倍均值法

假设剩余红包金额为m元，剩余人数为n，则有下面公式：

**每次抢到的金额=随机区间[ 0.01 ，m/n * 2 - 0.01 ] 元**

一句话：剩下的人平分剩余金额，平均每个人分x元，在0.01元到2倍x-0.01元之间（闭区间）随机一个金额作为结果，最后一个把剩下的全拿走。

#### 方法二

线段切割法

要分成n个红包，在金钱范围里随机n-1个不同的随机数，来切分成n块，作为分好的红包。



### 随机数

使用rand3生成rand5，一直追问，怎么提升成功的概率，成功的概率是多少，极限是多少。





### 中间件

### 大数据量（待更新！！！）



### 排查问题

#### cpu100%问题

- 先用top | grep java 看占用高的进程id
- 再用top -H -p pid 在进程的所有线程中找出占用高的线程id。这里前面显示的线程id是10进制的，可以通过 printf "%x\n" 数字 来把10进制转为16进制。方便之后在jstack dump出的信息中比对
- jstack pid > ./xxx.stack  导出进程快照。
- cat xxx.stack | grep '线程id(十六进制)' 查看这个进程中的对应线程，一般就能确定出问题的位置



#### FullGC问题

- 检查JVM配置
  - 通过jmap -heap pid  打印java进程的堆信息：垃圾收集器、堆配置信息、内存各区域使用情况
- 观察老年代的内存变化
  - 观察FGC后内存的回收情况，如果能回收很多内存，就可以排除内存泄露的问题
- 查看堆内存中的对象
  - 通过 jmap -histo[:live] pid 查看堆中对象的统计信息：每种类型的对象数量、对象占用内存大小
  - 看看哪种类型的内存占用不正常
- 分析堆内存文件
  - 对进程执行堆转储操作。 jmap -dump:format=b,file=heap.txt  17561
  - 使用工具导入dump出来的文件，也可以去分析各种对象所占空间，可以看到对象所在的对象，去分析问题可能发生在哪
- 代码分析可疑对象
  - 在代码中寻找对应的逻辑，分析对象的生命周期和GC频度的关系。
  - 有可能是分带年龄过小，导致太多对象在快结束生命周期时，晋升到了老年代。
- 解决方案
  - 修改分带年龄的设置
  - 优化对象的生命周期，在不需要时尽早释放引用。

