

# 准备

## Redis

## MySQL

用8，设置mysql的默认时区

![image-20200823003520638](优惠券项目.assets/image-20200823003520638.png)

## Kafka

### 消息系统

- 点对点消息系统
- 发布订阅消息系统

![image-20200823225848666](优惠券项目.assets/image-20200823225848666.png)

Kafka是一个分布式的发布订阅消息系统

![image-20200823231037874](优惠券项目.assets/image-20200823231037874.png)

- Topic：划分数据的类
- partition：每个Topic至少有一个partition。同一个partition里的数据是有序的，不同partition的数据可能是无序的，发送的消息可能进入p1或者p2
- Brokers：一个集群有多台服务器，一个服务器有一个Brokers，存储Topic中的数据，来维护负载均衡。
- producer：数据发布者，将消息发送到Topic，Brokers接收到消息后，把消息追加到partition中
- consumer：消费者，可以消费多个Topic中的数据。多个消费者可以组成消费者组。



### 安装

下载压缩包

打开config文件夹中server.properties

- broker.id：集群中唯一标识，这里默认就好
  - ![image-20200830002705532](优惠券项目.assets/image-20200830002705532.png)
- log.dirs：日志地址，根据需求自己修改
  - ![image-20200830002645796](优惠券项目.assets/image-20200830002645796.png)



![image-20200830002729653](优惠券项目.assets/image-20200830002729653.png)

- 先启动zk
- 启动kafka-server
- 创建topic
  - bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic first-kafka-topic
  - ![image-20200830003408049](优惠券项目.assets/image-20200830003408049.png)
- 查看topic
  - bin/kafka-topics.sh --list --zookeeper localhost:2181
- 启动消费者
  - bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic first-kafka-topic --from-beginning
- 启动生产者
  - bin/kafka-console-producer.sh --broker-list localhost:9092 --topic first-kafka-topic
  - ![image-20200830003918464](优惠券项目.assets/image-20200830003918464.png)



### 生产者消费者

![image-20200830004055871](优惠券项目.assets/image-20200830004055871.png)

消息中key的作用

- 提供描述消息的额外信息
- 决定消息写入哪个分区，相同key的消息肯定会分配到同一个分区



![image-20200830004400321](优惠券项目.assets/image-20200830004400321.png)

一个topic中的分区只会消费一次，不管消费者组中有多少个消费者

![image-20200830004643083](优惠券项目.assets/image-20200830004643083.png)

消费者组中消费者数量应该小于一个topic中分区的数量

![image-20200830004725152](优惠券项目.assets/image-20200830004725152.png)



### docker中安装



# Springboot相关





