





# 为什么DDD火

DDD（Domain Driven Design,领域驱动设计） 是一种开发复杂软件的系统化的方法学和思想。

## 为什么传统面向对象方法学不够，还要DDD

早期面向对象的成功，主要是在几个特定的领域，比如计算机语言、图形用户界面、办公自动化软件等等，但在企业应用方面还没有取得成功（企业应用包括银行贷款系统、保险公司理赔系统、电信公司计费系统等等）。

### 传统面向对象方法学还存在很多问题

1. 很多研发走了一条只重技术不重业务的弯路。
   1. 重技术不重业务的思想造成技术人员与业务人员之间难以相互理解，难以真正满足业务需求。
2. 围绕业务开发的方法学本身就不好学。
3. 早期面向对象方法学主要考虑的是建模技术，很少考虑协作问题。
   1. 很多伟大的软件开始的时候都是个人作品（UNIX、C语言），而企业应用多数是团队作战。
4. 难以适应编码。
   1. 早期面向对象方法学很少讨论如何应对变化的需求。



### DDD如何解决

DDD就是为了解决上述问题而提出的，从名字可以看出，领域就是业务领域，就是说要从业务出发进行系统设计，把开发者从重技术的路上拉回来。

DDD 从面向对象和敏捷中提炼出了一套原则、模式和实践，使面向对象方法学在企业应用中更加容易学习和掌握。使面向对象方法学在企业应用中更加容易学习和掌握。

DDD 非常强调业务人员和技术人员要一起协作进行领域建模，在这个过程中提炼领域知识。

DDD 重视如何应对变化，提出了所谓“柔性设计”的概念，使得模型和系统可以随着需求的变化而演进。随着业务变化，将变化频繁的部分重构得越来越灵活，而不常变化的部分则保持不变。也就是说，模型中的哪些部分需要设计得灵活，是自然演进形成的，这样就避免了“过度设计”。这个过程就是柔性设计。而这个重构的过程，也是不断加深领域知识理解的过程。



### 为什么之前不火

- 必要性不够强

在 DDD 刚出现的时候，很多企业软件还不太复杂。一些复杂的软件，变化也不像现在这样频繁。甚至还有一些企业，干脆每隔四五年把原来的系统推翻重建一次。

另一方面，当时一些新兴的产业，例如互联网，还处在跑马圈地、野蛮生长的阶段。这时关注的是系统快速上线，抢占市场，至于软件质量好不好，容不容易维护，暂时不是考虑的重点。

- 普及需要的前提条件不足

首先是敏捷软件开发刚刚出现不久，还不普及。如果没有迭代开发、持续重构、测试驱动、持续集成等敏捷实践的支持，构建良好的领域模型并在代码上落地是很困难的。

其次是配套的开发框架还不成熟。那时 J2EE 还被认为是企业应用事实上的标准，而基于这种框架开发程序，是很难和 DDD 的领域模型相衔接的。



### 为什么现在火起来了

- 数字化时代的到来

数字化时代，技术逐渐成为企业核心竞争力的主要因素，无论业务还是系统都变得更加复杂。因此，如何将业务和技术融为一体，就成了很多企业的主要问题，而这正是 DDD 的主要优势。

行业竞争的加剧也要求系统具有更好的用户体验、更高的质量、更快地满足变化的需求。这些问题很难解决，必须引入系统化的方法。

- DDD普及的前提条件已经准备好

现在，敏捷软件开发已经普及。迭代、演进、协作等思想已经深入人心。DevOps 技术应用得也日益广泛。而且 Spring boot 等轻量级框架已经得到广泛使用。这些框架支持了领域模型与具体技术的关注点分离，使开发人员从技术细节中解放出来，将更多的精力投入到领域逻辑本身的分析和设计。

再者，相关的架构实践也已经研究得比较透彻，像整洁架构、事件驱动架构以及 CQRS 等等，都有力地支持了 DDD 的落地实施。DDD 本身也在不断完善，比如补充了像领域事件等新的模式，出现了事件风暴等新的实践。



### 尽信DDD不如不用DDD。

这是我看到的一条评论。DDD也不是完美的理论，要用平常心来看待DDD，发现有用就用一下，不能用也不要勉强。



# 打通DDD的最小闭环



## 开启一个小项目

通过迭代一，实现一个“麻雀虽小、五脏俱全”的项目。打通从需求分析，到领域建模，再到架构设计，最后到数据库和代码实现的完整闭环。

### 迭代需求

经过了一轮市场调研，我们发现很多中小企业，都有诸如考勤管理、工时管理、项目管理、请假管理等通用的需求。我们姑且把这些应用统称为“企业管理系统”。



在领域驱动设计中有一个重要的角色叫做“领域专家”，叫业务专家也可以。领域专家需要对业务有总体性和本质性的把握，同时对业务发展也要有一定前瞻性，也就是说，心里要有一盘棋。

- 需求一：租户管理

多租户系统，系统可以提供给多个企业使用，数据隔离。

- 需求二：人员与组织管理

对员工可以增删改查，把员工分配到部门，每个员工只属于一个部门。

![img](https://static001.geekbang.org/resource/image/0d/55/0dd03878fd449eb774040bbcd6ab6e55.jpg?wh=2900x1700)



- 需求三：项目管理

租户要向它的客户提供服务，就要和客户签订合同，然后完成合同下的项目。

1. 一个租户企业可以有多个客户，可以在系统里对客户信息进行增删改查，每个客户都有一个客户经理来跟进；
2. 租户可以和它的客户签订多份合同，在系统中对合同信息进行增删改查，每个合同都有一个销售人员负责，可以开始和结束合同；
3. 一个合同下可以有多个项目，系统可以对项目进行增删改查，每个项目有一个项目经理；
4. 可以在系统中开始和结束项目，需要记录开始和结束时间等信息。项目结束以后，很多事情就不能随便做了。

![img](https://static001.geekbang.org/resource/image/cf/45/cf692b1b743f8eb6838670427ayyde45.jpg?wh=2900x1874)



- 需求四：人员分配

有了项目，我们就可以把员工分配到项目上，也可以让一个人退出项目。而且，一个项目可以有多个人参与，一个人又可以同时参与多个项目。

在把人分配到项目上的时候，还要记录每个人预计的投入百分比。为了让企业能够在总体上调配人力资源。

![img](https://static001.geekbang.org/resource/image/ec/2b/ec5acb036d224bde8fa6fb6df27d492b.jpg?wh=2380x1446)



- 需求五：工时登记

规定只有当一个员工分配到一个项目上以后，才能通过这个项目报工时。

每个员工每周都需要在系统中填报工时，登记自己哪一天在哪个项目上投入了多少时间。当然，员工可对工时进行查询和修改，还可以为每天的投入的时间填写备注。

![img](https://static001.geekbang.org/resource/image/5f/14/5fc49003a2936b3b1354a1d7c2f20c14.jpg?wh=2900x1287)



### DDD的基本开发过程

领域驱动设计中的主要流程。

![img](https://static001.geekbang.org/resource/image/3d/1e/3d591062766dede3e6039e1e0804261e.jpg?wh=2900x1314)

#### 模型的建立

模型的建立阶段，使用的都是**业务术语**，归根结底来自业务人员，业务人员不仅能听懂，而且负责评价建模的正确性。通过领域专家和开发人员的协作共同完成的。

- 捕获行为需求

在整个开发流程中，首先是要捕获行为需求，也就是传统软件工程里的“获取需求”。

在传统软件工程中，这一步常用的方式是用例建模，也就是用 Use Case 来建模。在这套课程里面，我们会用 DDD 中比较流行的一种方法，叫做“事件风暴”。



- 领域建模

接下来通过建立领域模型，把需求里的主要业务知识描述清楚。DDD 的领域模型，大体上相当于传统软件工程中的分析模型。

#### 模型的实现

模型的实现增加技术语言，则是业务人员不需要理解也不关注的，会包含技术实现方面的内容。两者的边界很重要。

- 架构设计

基于领域模型，我们就可以做架构设计，包括进程间和进程内的架构。比如说微服务设计、中台设计都属于进程间架构。而 DDD 分层架构，通常说的是进程内架构。



- 数据库设计
- 代码实现

在实践中，尤其是对敏捷软件开发来说，这些步骤不是线性的，而是反复迭代、互相穿插的。



## 事件风暴（上）：怎样和业务愉快地需求？

事件风暴的必要性包括从头脑中挖掘需求、补充遗漏的需求、使业务人员和技术人员理解一致，以及辅助识别领域对象四点。其中事件来自于领域事件，风暴来自于头脑风暴。

捕获行为需求的方法有好几种，在传统的软件工程中，最常用的方法是“用例”，也就是 Use Case。但是，Eric Evans 在《领域驱动设计》这本书里，并没有规定捕获行为需求的具体方法。直到 2013 年，一位叫 Alberto 的 DDD 专家提出了“事件风暴”，也就是 Event Storming。

事件风暴的主要过程：

![img](https://static001.geekbang.org/resource/image/ea/1b/ea006b757ab0b2aeff0d888128f9d31b.jpg?wh=3101x1393)



- 事件风暴的第一步：识别领域事件

1. 业务人员和技术人员在一起分别识别出领域事件，领域事件表示的是业务流程中每个步骤引发的结果，业务人员关注的那些已经发生的事情，例如订单已提交。领域事件意味着业务流程中每个步骤的结果。这种结果导向的思维方式更容易理清业务。
2. 然后对这些领域事件进行讨论，找出真正的领域事件，其中不能出现一些技术事件和动作（例如查询功能），要用一些业务术语和一些已经约定俗成的业务属于。逐步统一认知并统一语言。

先发散，后收敛，反复迭代

注意两点

1. 不要把技术事件当做领域事件
2. 不要把动作或者过程当做领域事件



“协作”才是事件风暴的精髓，而具体结果怎样呈现，反而是第二位的





